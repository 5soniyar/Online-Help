<!DOCTYPE HTML>
<html>
<head>
   <title>Create a ZFS-based Lustre file system</title>
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta http-equiv="content-language" content="en-us" />
   <meta name="description" content="The procedures in this section assume that you have first assembled and configured the physical hardware: servers, storage devices, network interfaces, etc., and installed..." />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link id="tabscheme" type="text/css" href="hm_topic.css" rel="stylesheet" />   
<style type="text/css">
/* No header topics */

/* Breadcrumb trail */
p#breadcrumbs {
font-family: Verdana, Tahoma, Helvetica, Sans-Serif;   padding: 2px 0 1px 2px;
   margin: 0;
   font-size: 8pt; 
   color: #999;
   }   
p#breadcrumbs a { color: #999; text-decoration: none;}
p#breadcrumbs a:visited {color: #999;}
p#breadcrumbs a:hover { color: #333; border-bottom: 1px dotted #333; }

/* Search hightlight color */
span.highlight {background-color: #ffff40;}
</style>
<script type="text/javascript">
var hmHeaderTopic = true;

</script> 
<!--[if IE 9]>
<link id="iesvgcss" rel="stylesheet" type="text/css" href="hm_webhelp_svg.css" />
<![endif]-->	
<script src="jquery.js"></script>
<script type="text/javascript" src="jquery.tools.min.js"></script>
<script type="text/javascript" src="jquery.scrollTo-min.js"></script>
<script type="text/javascript"> 
// General topic variables
var tVars = {
   hmHelpPage: "index.html",
   nextP: "importing_and_exporting_zfs_po.htm",
   prevP: "creating_and_managing_of_zfs-b.htm",
   currP: "creating_a_zfs-based_lustre_fi.htm",
   defP: "intel_manager_for_lustre.htm",
   mailUrl: "",
   mailUrlQuery: "",
   titleP: "Create a ZFS-based Lustre file system",
   mailsubject: "Feedback on: Intel® Manager for Lustre* software - Create a ZFS-based Lustre file system",
   sharesubject: "Intel® Manager for Lustre* software - Create a ZFS-based Lustre file system",
   simplesubject: "Documentation%20Feedback",
   mailid: "Creating_a_ZFS-based_Lustre_fi",
   mailpath: "Creating and Managing ZFS-based Lustre file systems &gt; Create a ZFS-based Lustre file system /",
   mailbody: "Dear Support Staff,",
   fbtype: false,
   header: true,
   background: "bg.png",
   tablesReady: false,
   togglesReady: false,
   webRedirect: true,
   topicTitleBar: true,
   printFooter: true,
   zoomTip: "Click to view full size image",
   autoPrint: true,
   printButton: "Print",
   printButtonTip: "Print the current topic"
   }
// Popup configuration
 var hmpBShadow = true;
 var hmPopSmallDim = 500;
 var hmPopKillVideo = true;
 // AutoTOC variables
 var hmatocvars = {
   atoc_show: true,
   atoc_title: "Contents",
   atoc_tip: "Jump to:&nbsp;",
   atoc_minHeaders: 3,
   atoc_btntip_off: "No contents entries on this page",
   atoc_btntip_on: "Display/hide topic directory",
   atoc_toptip: "Jump to top of page",
   atoc_top: "Scroll to Top of Page",
   atoc_bg: "#f6f6f6",
   atoc_border: "silver",
   atoc_linkcolor: "#444",
   atoc_linklimit: 45,
   atoc_hovercolor: "#000",
   atoc_hoverbgcolor: "#e0e0e0"
}
// Sortable tables
var sortVars = {
   europeandate: false,
   germanNumbers: false,
   imagePath: "",
   image_up: "arrow-up.gif",
   image_down: "arrow-down.gif",
   image_empty: "arrow-empty.gif",
   image_none: "arrow-none.gif",
   sort_tip: "Click to sort on this column",
   umlauts: "false"
   }

</script>

<script type="text/javascript">
if (tVars.topicTitleBar) { 
$(document).ready(function() {
var doc = document;  
try {
if (parent.hmWebHelp.navWidth != null) doc = parent.document;
doc.title = $("<div/>").html("Intel® Manager for Lustre* software - Create a ZFS-based Lustre file system").text();
window.onunload = function() {doc.title = $("<div/>").html("Intel® Manager for Lustre* software").text();}
} catch(err) {}
});
}
</script>

<script type="text/javascript" src="helpman_settings.js"></script>
<script type="text/javascript" src="helpman_topicinit.js"></script>
<script type="text/javascript" src="hmtopic.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "creating_a_zfs-based_lustre_fi.htm");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>
<!--ZOOMSTOP-->



<ul id="topictabs" class="tabs">
<li id="indextab" class="hmtabs"><a href="#" id="indextablink" class="current"><span>Create a ZFS-based Lustre file system</span></a></li>
</ul>
<div id="hmbox">
<div id="hmheader">
<div id="hmheadercontents">
 
<h1 class="p_Heading1"><span class="f_Heading1">Create a ZFS-based Lustre file system</span></h1>

</div>
<div id="atocIcon" class="navdivs">
<img class="navicon" id="hmAtocLink" src="contents_off.png" alt="No contents entries on this page" title="No contents entries on this page" />
<br /><span>Contents</span>
</div>
</div>
<div id="autoTocWrapper" class="topicmenu"></div>
<div id="idcontent">
<div id="unclicker"></div>

<!--ZOOMRESTART-->
<p class="p_BodyText"><span class="f_BodyText">The procedures in this section assume that you have first assembled and configured the physical hardware: servers, storage devices, network interfaces, etc., and installed Intel® Manager for Lustre* software as instructed in the </span><span class="f_BodyText" style="font-style: italic;">Intel® Enterprise Edition for Lustre* Software Installation Guide.  </span></p>
<p class="p_BodyText"><span class="f_BodyText">To create and manage an OpenZFS-based Lustre file system that is highly-available and managed by Intel® Manager for Lustre* software, perform these steps:</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 11px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:18px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">1.</span></td><td style="border:none"><span class="f_BodyText">Add all of the physical servers that will comprise your ZFS-based Lustre file system. To do this, perform the steps in <a href="configure_storage_servers.htm" class="topiclink">Add one or more HA servers</a>. Add each server as a </span><span class="f_BodyText" style="font-style: italic;">Managed Storage Server</span><span class="f_BodyText">.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 11px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:18px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">2.</span></td><td style="border:none"><span class="f_BodyText">Having added the servers, you now need to ensure that the server </span><span class="f_BodyText" style="font-style: italic;">hostids</span><span class="f_BodyText"> are set and then configure zpools. Each server requires a unique hostid to be configured. This provides some protection in ZFS against multiple simultaneous imports of zpools when the storage is connected to more than one server. To set the hostid, run the </span><span class="f_CodeExample">genhostid</span><span class="f_BodyText"> command on each host and reboot. In the document </span><span class="f_BodyText" style="font-style: italic;">Lustre* Installation and Configuration using Intel® EE for Lustre* Software and OpenZFS</span><span class="f_BodyText">, see the section </span><span class="f_BodyText" style="font-style: italic;">Protecting File System Volumes from Concurrent Access</span><span class="f_BodyText"> for more information.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 11px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:18px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">3.</span></td><td style="border:none"><span class="f_BodyText">ZFS pool configuration is executed directly on each of the Lustre server HA pairs using the command line tools supplied with the ZFS software. The storage devices for each ZFS pool must be connected to, and accessible from, each Lustre server in the HA pair. For each ZFS pool, it is easiest to nominate a primary server and use that host to create the zpool. Log into each primary host and use this zpool command to create each storage pool. &nbsp;The general syntax for creating a zpool is as follows:</span></td></tr></table></div><p class="p_BodyText" style="margin: 0px 0px 8px 48px;"><span class="f_CodeExample">zpool create [-f] -O canmount=off \</span><br />
<span class="f_CodeExample">[ -o ashift=&lt;n&gt; ] \</span><br />
<span class="f_CodeExample">-o cachefile=none \</span><br />
<span class="f_CodeExample">\&lt;zpool name&gt; &lt;zpool specification&gt;</span></p>
<p class="p_BodyText" style="margin: 0px 0px 8px 24px;"><span class="f_BodyText">For more details, refer to the section titled </span><span class="f_BodyText" style="font-style: italic;">ZFS OSDs</span><span class="f_BodyText">, in the guide titled</span><span class="f_BodyText" style="font-style: italic;"> Lustre* Installation and Configuration using Intel® EE for Lustre* Software and OpenZFS</span><span class="f_BodyText">.</span></p>
<p class="p_BodyText" style="margin: 0px 0px 8px 24px;"><span class="f_BodyText">Following are three </span><span class="f_BodyText" style="font-style: italic;">examples</span><span class="f_BodyText"> of typical pool configurations:</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 24px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:18px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">a.</span></td><td style="border:none"><span class="f_BodyText">ZFS pool for MGT (typically a simple mirror):</span></td></tr></table></div><p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">zpool&nbsp;create&nbsp;-O&nbsp;canmount=off&nbsp;\</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;-o&nbsp;cachefile=none&nbsp;\</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;mgspool&nbsp;mirror&nbsp;&lt;dev&nbsp;A&gt;&nbsp;&lt;dev&nbsp;B&gt;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 24px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:18px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">b.</span></td><td style="border:none"><span class="f_BodyText">ZFS pool for MDT (typically a stripe of mirrors to maximize performance):</span></td></tr></table></div><p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">zpool&nbsp;create&nbsp;-O&nbsp;canmount=off&nbsp;\</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;-o&nbsp;cachefile=none&nbsp;\</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;&lt;fsname&gt;-mdt&lt;n&gt;pool&nbsp;\</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;mirror&nbsp;&lt;dev&nbsp;A&gt;&nbsp;&lt;dev&nbsp;B&gt;&nbsp;[&nbsp;mirror&nbsp;&lt;dev&nbsp;C&gt;&nbsp;&lt;dev&nbsp;D&gt;&nbsp;]&nbsp;...</span></p>
<p class="p_BodyText" style="margin: 0px 0px 8px 48px;"><span class="f_BodyText">&nbsp;</span><br />
<span class="f_BodyText" style="font-weight: bold;">Note</span><span class="f_BodyText">: The naming convention for the pool name is intended to reflect the Lustre file system name and the MDT index number (usually 0, unless DNE is used). The number of mirrors used for the MDT depends on the requirements of the installation and can be scaled up accordingly.</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 24px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:18px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">c.</span></td><td style="border:none"><span class="f_BodyText">ZFS pool for OST (typically a RAIDZ2 pool, balancing reliability against optimal capacity):</span></td></tr></table></div><p class="p_CodeExample" style="margin: 0px 0px 0px 72px;"><span class="f_CodeExample">zpool&nbsp;create&nbsp;-O&nbsp;canmount=off&nbsp;\</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 72px;"><span class="f_CodeExample">&nbsp;&nbsp;-o&nbsp;cachefile=none&nbsp;\</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 72px;"><span class="f_CodeExample">&nbsp;&nbsp;[&nbsp;-o&nbsp;ashift=12&nbsp;]&nbsp;\</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 72px;"><span class="f_CodeExample">&nbsp;&nbsp;-o&nbsp;recordsize=1M&nbsp;\</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 72px;"><span class="f_CodeExample">&nbsp;&nbsp;&lt;fsname&gt;-ost&lt;n&gt;pool&nbsp;\</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 72px;"><span class="f_CodeExample">&nbsp;&nbsp;raidz2&nbsp;&lt;dev&nbsp;A&gt;&nbsp;&lt;dev&nbsp;B&gt;&nbsp;\</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 72px;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&lt;dev&nbsp;C&gt;&nbsp;&lt;dev&nbsp;D&gt;&nbsp;&nbsp;&lt;dev&nbsp;E&gt;&nbsp;&lt;dev&nbsp;F&gt;&nbsp;...</span><br />
<span class="f_CodeExample">&nbsp;</span></p>
<p class="p_BodyText" style="margin: 0px 0px 8px 48px;"><span class="f_BodyText" style="font-weight: bold;">Note</span><span class="f_BodyText">: See the document </span><span class="f_BodyText" style="font-style: italic;">Lustre* Installation and Configuration using Intel® EE for Lustre* Software and OpenZFS </span><span class="f_BodyText">for descriptions of the </span><span class="f_CodeExample">ashift</span><span class="f_BodyText"> and </span><span class="f_CodeExample">recordsize</span><span class="f_BodyText"> properties. RAIDZ2 is the preferred vdev configuration for OSTs, and we recommend an arrangement of at least 11 disks (9+2) per RAIDZ2 vdev for best performance. The pool naming convention is based on the Lustre file system name and OST index number, starting at 0 (zero).</span></p>
<p class="p_BodyText" style="margin: 0px 0px 8px 24px;"><span class="f_BodyText">The remainder of this procedure is performed at the Intel® Manager for Lustre* software GUI. </span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 11px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:18px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">4.</span></td><td style="border:none"><span class="f_BodyText">For high-availability, configure your servers as primary and fail-over servers. &nbsp;Perform the steps in <a href="configure_the_volumes.htm" class="topiclink">Configure primary and fail-over servers</a>.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 11px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:18px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">5.</span></td><td style="border:none"><span class="f_BodyText">If your are using power distribution units (PDUs) for power control, then for each server, perform the steps in <a href="configure_power_distribution_u.htm" class="topiclink">Add power distribution units</a>. &nbsp;Then perform the steps in <a href="assign_pdu_outlets_to_servers.htm" class="topiclink">Assign PDU outlets to servers</a> for each server.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 11px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:18px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">6.</span></td><td style="border:none"><span class="f_BodyText">If you are using Baseboard Management Controllers (BMCs) for power control, then perform the steps in <a href="configure_ipmi_and_add_bmcs.htm" class="topiclink">Assign BMCs to servers</a> for each server.  </span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 11px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:18px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">7.</span></td><td style="border:none"><span class="f_BodyText">Perform the steps in <a href="create_the_file_system.htm" class="topiclink">Create the new Lustre file system</a>, using the zpools you created in step 3 above as object storage targets (volumes),</span><span class="f_BodyText" style="font-style: italic;"> </span><span class="f_BodyText">rather than direct block devices. &nbsp;Each ZFS pool that you created will appear as a target, with the </span><span class="f_BodyText" style="font-style: italic;">Type</span><span class="f_BodyText"> identified as a </span><span class="f_BodyText" style="font-weight: bold;">ZfsPool.</span></td></tr></table></div>
<!--ZOOMSTOP-->

</div> <!-- idcontent -->
</div><!-- hmbox --> 
</body>
</html>
