<!DOCTYPE HTML>
<html>
<head>
   <title>Importing and exporting ZFS pools in a shared-storage high-availability cluster</title>
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta http-equiv="content-language" content="en-us" />
   <meta name="description" content="ZFS file system datasets are always members of a pool, and the pool must be imported to a host before any action can be taken to alter its content. In a shared-storage,..." />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link id="tabscheme" type="text/css" href="hm_topic.css" rel="stylesheet" />   
<style type="text/css">
/* No header topics */

/* Breadcrumb trail */
p#breadcrumbs {
font-family: Verdana, Tahoma, Helvetica, Sans-Serif;   padding: 2px 0 1px 2px;
   margin: 0;
   font-size: 8pt; 
   color: #999;
   }   
p#breadcrumbs a { color: #999; text-decoration: none;}
p#breadcrumbs a:visited {color: #999;}
p#breadcrumbs a:hover { color: #333; border-bottom: 1px dotted #333; }

/* Search hightlight color */
span.highlight {background-color: #ffff40;}
</style>
<script type="text/javascript">
var hmHeaderTopic = true;

</script> 
<!--[if IE 9]>
<link id="iesvgcss" rel="stylesheet" type="text/css" href="hm_webhelp_svg.css" />
<![endif]-->	
<script src="jquery.js"></script>
<script type="text/javascript" src="jquery.tools.min.js"></script>
<script type="text/javascript" src="jquery.scrollTo-min.js"></script>
<script type="text/javascript"> 
// General topic variables
var tVars = {
   hmHelpPage: "index.html",
   nextP: "removing_a_zfs-based_lustre_fi.htm",
   prevP: "creating_a_zfs-based_lustre_fi.htm",
   currP: "importing_and_exporting_zfs_po.htm",
   defP: "intel_manager_for_lustre.htm",
   mailUrl: "",
   mailUrlQuery: "",
   titleP: "Importing and exporting ZFS pools in a shared-storage high-availability cluster",
   mailsubject: "Feedback on: Intel® Manager for Lustre* software - Importing and exporting ZFS pools in a shared-storage high-availability cluster",
   sharesubject: "Intel® Manager for Lustre* software - Importing and exporting ZFS pools in a shared-storage high-availability cluster",
   simplesubject: "Documentation%20Feedback",
   mailid: "Importing_and_exporting_ZFS_po",
   mailpath: "Creating and Managing ZFS-based Lustre file systems &gt; Importing and exporting ZFS pools in a shared-storage high-availability cluster /",
   mailbody: "Dear Support Staff,",
   fbtype: false,
   header: true,
   background: "bg.png",
   tablesReady: false,
   togglesReady: false,
   webRedirect: true,
   topicTitleBar: true,
   printFooter: true,
   zoomTip: "Click to view full size image",
   autoPrint: true,
   printButton: "Print",
   printButtonTip: "Print the current topic"
   }
// Popup configuration
 var hmpBShadow = true;
 var hmPopSmallDim = 500;
 var hmPopKillVideo = true;
 // AutoTOC variables
 var hmatocvars = {
   atoc_show: true,
   atoc_title: "Contents",
   atoc_tip: "Jump to:&nbsp;",
   atoc_minHeaders: 3,
   atoc_btntip_off: "No contents entries on this page",
   atoc_btntip_on: "Display/hide topic directory",
   atoc_toptip: "Jump to top of page",
   atoc_top: "Scroll to Top of Page",
   atoc_bg: "#f6f6f6",
   atoc_border: "silver",
   atoc_linkcolor: "#444",
   atoc_linklimit: 45,
   atoc_hovercolor: "#000",
   atoc_hoverbgcolor: "#e0e0e0"
}
// Sortable tables
var sortVars = {
   europeandate: false,
   germanNumbers: false,
   imagePath: "",
   image_up: "arrow-up.gif",
   image_down: "arrow-down.gif",
   image_empty: "arrow-empty.gif",
   image_none: "arrow-none.gif",
   sort_tip: "Click to sort on this column",
   umlauts: "false"
   }

</script>

<script type="text/javascript">
if (tVars.topicTitleBar) { 
$(document).ready(function() {
var doc = document;  
try {
if (parent.hmWebHelp.navWidth != null) doc = parent.document;
doc.title = $("<div/>").html("Intel® Manager for Lustre* software - Importing and exporting ZFS pools in a shared-storage high-availability cluster").text();
window.onunload = function() {doc.title = $("<div/>").html("Intel® Manager for Lustre* software").text();}
} catch(err) {}
});
}
</script>

<script type="text/javascript" src="helpman_settings.js"></script>
<script type="text/javascript" src="helpman_topicinit.js"></script>
<script type="text/javascript" src="hmtopic.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "importing_and_exporting_zfs_po.htm");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>
<!--ZOOMSTOP-->



<ul id="topictabs" class="tabs">
<li id="indextab" class="hmtabs"><a href="#" id="indextablink" class="current"><span>Importing and exporting ZFS pools in a shared-storage high-availability cluster</span></a></li>
</ul>
<div id="hmbox">
<div id="hmheader">
<div id="hmheadercontents">
 
<h1 class="p_Heading1"><span class="f_Heading1">Importing and exporting ZFS pools in a shared-storage high-availability cluster</span></h1>

</div>
<div id="atocIcon" class="navdivs">
<img class="navicon" id="hmAtocLink" src="contents_off.png" alt="No contents entries on this page" title="No contents entries on this page" />
<br /><span>Contents</span>
</div>
</div>
<div id="autoTocWrapper" class="topicmenu"></div>
<div id="idcontent">
<div id="unclicker"></div>

<!--ZOOMRESTART-->
<p class="p_BodyText"><span class="f_BodyText">ZFS file system datasets are always members of a pool, and the pool must be imported to a host before any action can be taken to alter its content. In a shared-storage, high-availability cluster, some pools may be imported on different hosts. This is a common and recommended practice that balances distribution of Lustre OSDs equitably across the HA cluster nodes. </span></p>
<p class="p_BodyText"><span class="f_BodyText">One must always manage ZFS pools and their contents from the host where the pool is imported, but it is easy to overlook and miss ZFS pools that are exported. Use the combined output of</span><span class="f_CodeExample"> zpool list </span><span class="f_BodyText">and </span><span class="f_CodeExample">zpool import</span><span class="f_BodyText"> to gain a complete list of all storage pools available to a host, and import any pools that require administration.</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 10px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:22px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">1.</span></td><td style="border:none"><span class="f_BodyText">List the currently imported ZFS pools:</span></td></tr></table></div><p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">zpool&nbsp;list</span><br />
<span class="f_CodeExample">&nbsp;</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 11px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:22px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">2.</span></td><td style="border:none"><span class="f_BodyText">If any of the pools that are expected to be on this host are missing, it may be that the pools have been exported, or are imported on a different host. Use the</span><span class="f_CodeExample"> zpool import</span><span class="f_BodyText"> command to identify these pools. For example:</span></td></tr></table></div><p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">[root@rh7z-oss1&nbsp;~]#&nbsp;zpool&nbsp;import</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;pool:&nbsp;demo-ost0pool</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id:&nbsp;12622396723776112603</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;state:&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;action:&nbsp;The&nbsp;pool&nbsp;can&nbsp;be&nbsp;imported&nbsp;using&nbsp;its&nbsp;name&nbsp;or&nbsp;numeric&nbsp;identifier.</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;config:</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">demo-ost0pool&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;raidz2-0&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;sda&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;sdb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;sdc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;sdd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;sde&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;sdf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;pool:&nbsp;demo-ost1pool</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id:&nbsp;617459513944251623</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;state:&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;status:&nbsp;The&nbsp;pool&nbsp;was&nbsp;last&nbsp;accessed&nbsp;by&nbsp;another&nbsp;system.</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;action:&nbsp;The&nbsp;pool&nbsp;can&nbsp;be&nbsp;imported&nbsp;using&nbsp;its&nbsp;name&nbsp;or&nbsp;numeric&nbsp;identifier&nbsp;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;the&nbsp;'-f'&nbsp;flag.</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;see:&nbsp;http://zfsonlinux.org/msg/ZFS-8000-EY</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;config:</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">demo-ost1pool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;raidz2-0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;scsi-0QEMU_QEMU_HARDDISK_IEELOST0001&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;scsi-0QEMU_QEMU_HARDDISK_IEELOST0007&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;scsi-0QEMU_QEMU_HARDDISK_IEELOST0011&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;scsi-0QEMU_QEMU_HARDDISK_IEELOST0010&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;scsi-0QEMU_QEMU_HARDDISK_IEELOST0009&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span style="width:12px">&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;scsi-0QEMU_QEMU_HARDDISK_IEELOST0008&nbsp;&nbsp;ONLINE</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_BodyText" style="margin: 0px 0px 8px 24px;"><span class="f_BodyText">In the example, there are two exported pools. Note that the second pool in the list has a </span><span class="f_CodeExample">status</span><span class="f_BodyText"> attribute that is not displayed in the first pool, and that the </span><span class="f_CodeExample">action</span><span class="f_BodyText"> attribute indicates that the pool can only be imported by force (indicated by the </span><span class="f_CodeExample">'-f'</span><span class="f_BodyText"> flag). This means that the pool has been imported on a different host. Do not import pools that are in this condition unless it can be absolutely determined that the other host is offline or does not have this pool running (this is commonly the case when a server crashes or loses power in an unclean shutdown).</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 10px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:22px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">3.</span></td><td style="border:none"><span class="f_BodyText">Use the zpool import command, along with the pool name, to import a pool onto the host:</span></td></tr></table></div><p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">zpool&nbsp;import&nbsp;[-f]&nbsp;&lt;pool&nbsp;name&gt;</span><br />
<span class="f_CodeExample">&nbsp;</span></p>
<p class="p_BodyText" style="margin: 0px 0px 8px 24px;"><span class="f_BodyText">For example:</span></p>
<p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">[root@rh7z-oss1&nbsp;~]#&nbsp;zpool&nbsp;import&nbsp;demo-ost0pool</span><br />
<span class="f_CodeExample">&nbsp;</span></p>
<p class="p_BodyText"><span class="f_BodyText">A simple approach to managing all of the pools of an HA cluster as a batch, is to export all of the pools from each host connected to common shared storage, and then import all of the pools into a single host, as follows:</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 7px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:22px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">1.</span></td><td style="border:none"><span class="f_BodyText">Export all of the pools on a host:</span></td></tr></table></div><p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">zpool&nbsp;export&nbsp;–a</span><br />
<span class="f_CodeExample">&nbsp;</span></p>
<p class="p_BodyText" style="margin: 0px 0px 8px 24px;"><span class="f_BodyText">Repeat this on every host in the HA framework</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 8px 8px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: 1.10;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:22px"><span style="font-size:12pt; font-family: 'Calibri';color:#000000;">2.</span></td><td style="border:none"><span class="f_BodyText">On one host, import all of the zpools:</span></td></tr></table></div><p class="p_CodeExample" style="margin: 0px 0px 0px 48px;"><span class="f_CodeExample">zpool&nbsp;import&nbsp;-a</span></p>

<!--ZOOMSTOP-->

</div> <!-- idcontent -->
</div><!-- hmbox --> 
</body>
</html>
